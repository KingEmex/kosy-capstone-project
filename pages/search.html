<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Home - My Dictionary</title>
<link rel="stylesheet" href="/bootstrap-5.3.8-dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css">

<!-- fav-icons -->
<link rel="icon" href="/assets/favicon.ico/favicon.ico" type="image/x-icon">
<style>
body { 
  background-image: url(/assets/image/old-books-arrangement-with-light.jpg); 
  background-size: cover; 
  margin-bottom:70px; 
  font-family: Arial,sans-serif; 
}
#searchInput { padding-left:2.2rem; }
.loader { display:none; border:5px solid #f3f3f3; border-radius:50%; border-top:5px solid #007bff; width:40px; height:40px; animation:spin 1s linear infinite; margin:20px auto;}
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
.word-card { background:white; padding:15px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); margin-top:20px; }
#suggestions { background:#f8f9fa; border:1px solid #ddd; border-radius:5px; max-height:150px; overflow-y:auto; position:absolute; width:100%; z-index:1000; }
#suggestions div { padding:8px; cursor:pointer; }
#suggestions div:hover { background:#007bff; color:white; }
.btn-group { margin-top:10px; }
.bottom-navbar { position:fixed; bottom:0; width:100%; background:black; box-shadow:0 -2px 5px rgba(0,0,0,0.1); height:60px; display:flex; justify-content:space-around; align-items:center; }
.bottom-navbar .nav-item { display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; cursor:pointer; font-size:0.8rem; }
.bottom-navbar .nav-item.active { color:#007bff; }
.bottom-navbar .nav-item i { font-size:1.5rem; }

/* Trending ticker */
#trendingTickerContainer {
  width: 100%;
  overflow: hidden;
  border-radius: 5px;
  background: #f8f9fa;
  position: relative;
  height: 40px;
  display: flex;
  align-items: center;
  margin-top: 15px;
}

#trendingTicker {
  display: flex;
  position: absolute;
  white-space: nowrap;
  left: 100%;
}

#trendingTicker .trending-item {
  padding: 0 20px;
  cursor: pointer;
  font-weight: bold;
  color: #007bff;
  white-space: nowrap;
}

#trendingTicker .trending-item:hover {
  color: #0056b3;
}
</style>
</head>
<body>

<div class="container bg-dark shadow rounded mt-4 w-75 p-4">
  <h2 class="text-center text-primary mb-4"><i class="bi bi-book"></i> My Dictionary</h2>
  <h4 class="text-start text-white mt-3">Look up a word, learn it forever</h4>

  <!-- Search Input -->
  <div class="mb-3 position-relative">
    <input type="text" id="searchInput" class="form-control ps-5" placeholder="Search for a word..." />
    <span class="position-absolute top-50 start-0 translate-middle-y ps-3 text-muted">
      <i class="bi bi-search"></i>
    </span>
    <div id="suggestions"></div>
  </div>

  <div class="d-flex justify-content-between mb-3">
    <button id="searchBtn" class="btn btn-primary w-100"><i class="bi bi-search"></i> Search</button>
  </div>

  <div class="loader" id="loader"></div>
  <div id="result"></div>

  <!-- Trending Ticker -->
  <div class="mt-4">
    <h4 class="text-white">Trending Searches</h4>
    <div id="trendingTickerContainer">
      <div id="trendingTicker"></div>
    </div>
  </div>
</div>

<!-- Bottom Navbar -->
<nav class="bottom-navbar">
  <div id="navHome" class="nav-item active">
    <i class="bi bi-house"></i><div>Home</div>
  </div>
  <div id="navHistory" class="nav-item">
    <i class="bi bi-clock-history"></i><div>History</div>
  </div>
</nav>

<script>
const searchBtn = document.getElementById("searchBtn");
const wordInput = document.getElementById("searchInput");
const resultDiv = document.getElementById("result");
const loaderdiv = document.getElementById("loader");
const suggestionsBox = document.getElementById("suggestions");
let isReading = false;
let history = JSON.parse(localStorage.getItem("searchHistory")) || [];

// --- Search ---
searchBtn.addEventListener("click", ()=>{
  const word = wordInput.value.trim();
  suggestionsBox.innerHTML = "";
  if(!word){
    resultDiv.innerHTML=`<div class="alert alert-warning mt-3">‚ö†Ô∏è Please enter text.</div>`;
    return;
  }
  saveToHistory(word);
  fetchWord(word);
});

// --- Save history ---
function saveToHistory(word){
  if(!history.includes(word)){
    history.unshift(word);
    if(history.length>20) history.pop();
    localStorage.setItem("searchHistory", JSON.stringify(history));
  }
}

// --- Loader ---
function showLoader(){ loaderdiv.style.display="block"; }
function hideLoader(){ loaderdiv.style.display="none"; }

// --- Fetch word ---
function fetchWord(word){
  showLoader();
  fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`)
    .then(res=>res.json())
    .then(data=>{
      hideLoader();
      if(data.title && data.message){
        resultDiv.innerHTML=`<div class="alert alert-danger mt-3">${data.message}</div>`;
      } else { displayWord(data[0]); }
    })
    .catch(err=>{ hideLoader(); resultDiv.innerHTML=`<div class="alert alert-warning mt-3">‚ö†Ô∏è ${err.message}</div>`; });
}

// --- Suggestions ---
wordInput.addEventListener("input", ()=>{
  const query = wordInput.value.trim().toLowerCase();
  suggestionsBox.innerHTML = "";
  if(query.length < 2) return;
  fetch(`https://api.datamuse.com/sug?s=${encodeURIComponent(query)}`)
    .then(res=>res.json())
    .then(suggestions=>{
      suggestions.slice(0,5).forEach(s=>{
        const div = document.createElement("div");
        div.textContent = s.word;
        div.addEventListener("click", ()=>{ wordInput.value=s.word; suggestionsBox.innerHTML=""; searchBtn.click(); });
        suggestionsBox.appendChild(div);
      });
    }).catch(err=>console.error("Suggestion API error:",err));
});

// --- Display word with Read & Reset ---
function displayWord(data){
  resultDiv.innerHTML=`
    <div class="word-card">
      <h3>${data.word}</h3>
      <p><strong>Phonetics:</strong> ${data.phonetic||"N/A"}</p>
      ${data.meanings.map(m=>`<div><h5>${m.partOfSpeech}</h5>${m.definitions.map(d=>`<p><strong>Definition:</strong> ${d.definition}</p>${d.example?`<p><em>Example: ${d.example}</em></p>`:""}`).join("")}</div>`).join("")}
      <div class="btn-group">
        <button id="readBtn" class="btn btn-secondary me-2"><i class="bi bi-volume-up"></i> üîä Read</button>
        <button id="resetBtn" class="btn btn-danger"><i class="bi bi-x-circle"></i> Reset</button>
      </div>
    </div>
  `;

  const readBtn = document.getElementById("readBtn");
  const resetBtn = document.getElementById("resetBtn");

  readBtn.addEventListener("click", ()=>{
    if(isReading){ speechSynthesis.cancel(); isReading=false; readBtn.textContent="üîä Read"; return; }

    const chunks = [];
    if(data.word) chunks.push({text:"Word: "+data.word, pause:600});
    if(data.phonetic) chunks.push({text:"Phonetic: "+data.phonetic, pause:400});
    data.meanings.forEach(m=>{
      chunks.push({text:m.partOfSpeech, pause:400});
      m.definitions.forEach(d=>{
        chunks.push({text:"Definition: "+d.definition, pause:400});
        if(d.example) chunks.push({text:"Example: "+d.example, pause:400});
      });
    });

    let index=0; isReading=true; readBtn.textContent="‚èπ Stop";
    function speakNext(){
      if(!isReading || index>=chunks.length){ isReading=false; readBtn.textContent="üîä Read"; return; }
      const utter = new SpeechSynthesisUtterance(chunks[index].text);
      utter.lang="en-US"; utter.rate=1; utter.pitch=1;
      utter.onend = ()=>{ index++; setTimeout(speakNext, chunks[index-1].pause); };
      speechSynthesis.speak(utter);
    }
    speakNext();
  });

  resetBtn.addEventListener("click", ()=>{ speechSynthesis.cancel(); isReading=false; resultDiv.innerHTML=""; wordInput.value=""; });
}

// --- Load blank page ---
window.addEventListener("DOMContentLoaded", ()=>{ wordInput.value=""; resultDiv.innerHTML=""; });

// --- Bottom nav ---
document.getElementById("navHome").addEventListener("click", ()=>{}); // already home
document.getElementById("navHistory").addEventListener("click", ()=> window.location.href="history.html");

// --- Trending Ticker ---
const trendingTicker = document.getElementById("trendingTicker");
const trendingTickerContainer = document.getElementById("trendingTickerContainer");
let tickerPaused = false;

trendingTickerContainer.addEventListener("mouseenter", ()=> tickerPaused = true);
trendingTickerContainer.addEventListener("mouseleave", ()=> tickerPaused = false);

function getRandomTrending(arr, count=8){
  const shuffled = arr.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
}

function renderTicker(){
  trendingTicker.innerHTML = "";
  const words = getRandomTrending(allTrending, 8);
  words.forEach(word=>{
    const div = document.createElement("div");
    div.className="trending-item";
    div.textContent = word;
    div.addEventListener("click", ()=>{
      wordInput.value = word;
      suggestionsBox.innerHTML = "";
      searchBtn.click();
    });
    trendingTicker.appendChild(div);
  });
  startTickerAnimation();
}

function startTickerAnimation(){
  let totalWidth = trendingTicker.scrollWidth;
  trendingTicker.style.left = "100%";
  const speed = 0.5;
  function animate(){
    if(!tickerPaused){
      let currentLeft = parseFloat(trendingTicker.style.left);
      currentLeft -= speed;
      if(currentLeft < -totalWidth){
        currentLeft = trendingTickerContainer.offsetWidth;
      }
      trendingTicker.style.left = currentLeft + "px";
    }
    requestAnimationFrame(animate);
  }
  animate();
}

// Initial render
const allTrending = [
  "dictionary","language","education","science",
  "history","technology","literature","art",
  "grammar","vocabulary","mathematics","physics",
  "geography","biology","chemistry","coding"
];

renderTicker();
setInterval(renderTicker, 15000); // update trending every 15 seconds
</script>
</body>
</html>